<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="热门技术文章分享">
    <meta name="keyword"  content="fe, js, css, html5, nodejs, webpack, react, vue, nginx">
    <meta name="baidu-site-verification" content="zjvdQ5tUdb" />
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        mongodb 增删改查CURD基本操作总结 - llllll的博客 | HotLinkHub
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158254594-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-158254594-1');
    </script>

<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> H5 React Webpack Mongodb JS CSS Vue </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>llllll</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#插入数据"><span class="toc-text">插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#插入一条数据"><span class="toc-text">插入一条数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入多条数据"><span class="toc-text">插入多条数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查找数据"><span class="toc-text">查找数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#普通查询"><span class="toc-text">普通查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询数组"><span class="toc-text">查询数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制查询语句输出结果"><span class="toc-text">控制查询语句输出结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何显示null或者缺失字段"><span class="toc-text">如何显示null或者缺失字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用游标操作数据"><span class="toc-text">使用游标操作数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新数据"><span class="toc-text">更新数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用聚合更新数据"><span class="toc-text">使用聚合更新数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update方法"><span class="toc-text">update方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除数据"><span class="toc-text">删除数据</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> H5 React Webpack Mongodb JS CSS Vue </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        mongodb 增删改查CURD基本操作总结
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2020-03-04 20:49:35</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#mongodb" title="mongodb">mongodb</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <blockquote>
<p>基于mongodb v4.2 <a href="https://docs.mongodb.com/manual/introduction/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/introduction/</a></p>
</blockquote>
<h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><h3 id="插入一条数据"><a href="#插入一条数据" class="headerlink" title="插入一条数据"></a>插入一条数据</h3><p><code>db.collection.insertOne()</code> 插入一个文档到集合中</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   db.products.insert<span class="constructor">One( &#123; <span class="params">item</span>: <span class="string">"card"</span>, <span class="params">qty</span>: 15 &#125; )</span>;</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">   print (e);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 返回值：</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">   <span class="string">"insertedId"</span> : <span class="constructor">ObjectId(<span class="string">"56fc40f9d735c28df206d078"</span>)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插入多条数据"><a href="#插入多条数据" class="headerlink" title="插入多条数据"></a>插入多条数据</h3><p><code>db.collection.insertMany()</code> 同时插入多条数据到集合中</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   db.products.insertMany( [</span><br><span class="line">      &#123; <span class="string">item:</span> <span class="string">"card"</span>, <span class="string">qty:</span> <span class="number">15</span> &#125;,</span><br><span class="line">      &#123; <span class="string">item:</span> <span class="string">"envelope"</span>, <span class="string">qty:</span> <span class="number">20</span> &#125;,</span><br><span class="line">      &#123; <span class="string">item:</span> <span class="string">"stamps"</span> , <span class="string">qty:</span> <span class="number">30</span> &#125;</span><br><span class="line">   ] );</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">   print (e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回值：</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"acknowledged"</span> : <span class="literal">true</span>,</span><br><span class="line">   <span class="string">"insertedIds"</span> : [</span><br><span class="line">      ObjectId(<span class="string">"562a94d381cb9f1cd6eb0e1a"</span>),</span><br><span class="line">      ObjectId(<span class="string">"562a94d381cb9f1cd6eb0e1b"</span>),</span><br><span class="line">      ObjectId(<span class="string">"562a94d381cb9f1cd6eb0e1c"</span>)</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>insert 特性：<br>如果当前集合不存在，会自动创建一个集合。</p>
<p>_id 属性：<br>mongodb里面，如果你不提供_id，mongodb会默认在插入文档的时候为每一个文档创建一个唯一的_id，作为主键</p>
<h2 id="查找数据"><a href="#查找数据" class="headerlink" title="查找数据"></a>查找数据</h2><p>mongodb可以使用<code>find</code>方法查找数据</p>
<h3 id="普通查询"><a href="#普通查询" class="headerlink" title="普通查询"></a>普通查询</h3><blockquote>
<p>每个文档插入到集合中如果不提供一个_id字段，则mongodb会自动生成一个，并且在查询语句中默认返回，这里省略没有显示该字段</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例数据</span></span><br><span class="line">db.inventory.insertMany( [</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"journal"</span>, <span class="string">qty:</span> <span class="number">25</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">14</span>, <span class="string">w:</span> <span class="number">21</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"notebook"</span>, <span class="string">qty:</span> <span class="number">50</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">8.5</span>, <span class="string">w:</span> <span class="number">11</span>, <span class="string">uom:</span> <span class="string">"in"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"paper"</span>, <span class="string">qty:</span> <span class="number">100</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">8.5</span>, <span class="string">w:</span> <span class="number">11</span>, <span class="string">uom:</span> <span class="string">"in"</span> &#125;, <span class="string">status:</span> <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"planner"</span>, <span class="string">qty:</span> <span class="number">75</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">22.85</span>, <span class="string">w:</span> <span class="number">30</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"postcard"</span>, <span class="string">qty:</span> <span class="number">45</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">10</span>, <span class="string">w:</span> <span class="number">15.25</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">查找</span> <span class="string">size</span> <span class="string">等于</span> <span class="string">&#123;</span> <span class="attr">h:</span> <span class="number">14</span><span class="string">,</span> <span class="attr">w:</span> <span class="number">21</span><span class="string">,</span> <span class="attr">uom:</span> <span class="string">"cm"</span> <span class="string">&#125;</span> <span class="string">的数据</span></span><br><span class="line"><span class="string">db.inventory.find(</span> <span class="string">&#123;</span> <span class="attr">size:</span> <span class="string">&#123;</span> <span class="attr">h:</span> <span class="number">14</span><span class="string">,</span> <span class="attr">w:</span> <span class="number">21</span><span class="string">,</span> <span class="attr">uom:</span> <span class="string">"cm"</span> <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">)</span></span><br><span class="line"><span class="string">//</span> <span class="string">or</span> <span class="string">查找</span> <span class="string">qty</span> <span class="string">等于</span> <span class="number">25</span> <span class="string">的数据</span></span><br><span class="line"><span class="string">db.inventory.find(&#123;</span> <span class="attr">qty:</span> <span class="number">25</span> <span class="string">&#125;)</span></span><br><span class="line"><span class="string">//</span> <span class="string">or</span> <span class="string">使用嵌套查询</span> <span class="string">size</span> <span class="string">的</span> <span class="string">uom</span> <span class="string">等于</span> <span class="string">in</span> <span class="string">的数据</span></span><br><span class="line"><span class="string">db.inventory.find(</span> <span class="string">&#123;</span> <span class="attr">"size.uom":</span> <span class="string">"in"</span> <span class="string">&#125;</span> <span class="string">)</span></span><br><span class="line"><span class="string">//</span> <span class="string">$lt</span> <span class="string">小于</span></span><br><span class="line"><span class="string">db.inventory.find(</span> <span class="string">&#123;</span> <span class="attr">"size.h":</span> <span class="string">&#123;</span> <span class="string">$lt:</span> <span class="number">15</span> <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">)</span></span><br><span class="line"><span class="string">//</span> <span class="string">复合条件查询，查询</span> <span class="string">size.h</span> <span class="string">小于</span> <span class="number">15</span><span class="string">，</span> <span class="string">并且</span> <span class="string">size.uom</span> <span class="string">等于</span> <span class="string">in，并且</span> <span class="string">status</span> <span class="string">等于</span> <span class="string">D</span> <span class="string">的数据</span></span><br><span class="line"><span class="string">db.inventory.find(</span> <span class="string">&#123;</span> <span class="attr">"size.h":</span> <span class="string">&#123;</span> <span class="string">$lt:</span> <span class="number">15</span> <span class="string">&#125;,</span> <span class="attr">"size.uom":</span> <span class="string">"in"</span><span class="string">,</span> <span class="attr">status:</span> <span class="string">"D"</span> <span class="string">&#125;</span> <span class="string">)</span></span><br></pre></td></tr></table></figure>

<h3 id="查询数组"><a href="#查询数组" class="headerlink" title="查询数组"></a>查询数组</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例数据</span></span><br><span class="line">db.inventory.insertMany([</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"journal"</span>, <span class="string">qty:</span> <span class="number">25</span>, <span class="string">tags:</span> [<span class="string">"blank"</span>, <span class="string">"red"</span>], <span class="string">dim_cm:</span> [ <span class="number">14</span>, <span class="number">21</span> ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"notebook"</span>, <span class="string">qty:</span> <span class="number">50</span>, <span class="string">tags:</span> [<span class="string">"red"</span>, <span class="string">"blank"</span>], <span class="string">dim_cm:</span> [ <span class="number">14</span>, <span class="number">21</span> ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"paper"</span>, <span class="string">qty:</span> <span class="number">100</span>, <span class="string">tags:</span> [<span class="string">"red"</span>, <span class="string">"blank"</span>, <span class="string">"plain"</span>], <span class="string">dim_cm:</span> [ <span class="number">14</span>, <span class="number">21</span> ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"planner"</span>, <span class="string">qty:</span> <span class="number">75</span>, <span class="string">tags:</span> [<span class="string">"blank"</span>, <span class="string">"red"</span>], <span class="string">dim_cm:</span> [ <span class="number">22.85</span>, <span class="number">30</span> ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"postcard"</span>, <span class="string">qty:</span> <span class="number">45</span>, <span class="string">tags:</span> [<span class="string">"blue"</span>], <span class="string">dim_cm:</span> [ <span class="number">10</span>, <span class="number">15.25</span> ] &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// 查询 <span class="keyword">tags</span> 等于 [<span class="string">"red"</span>, <span class="string">"blank"</span>] 的数据</span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; <span class="keyword">tag</span><span class="variable">s:</span> [<span class="string">"red"</span>, <span class="string">"blank"</span>] &#125; )</span><br><span class="line"></span><br><span class="line">// 或者你想查询<span class="keyword">tags</span>包含 <span class="keyword">red</span> blank，不管它的顺序，或者是否还有其他元素，你可以使用 `$<span class="keyword">all</span>`</span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; <span class="keyword">tag</span><span class="variable">s:</span> &#123; $<span class="keyword">al</span><span class="variable">l:</span> [<span class="string">"red"</span>, <span class="string">"blank"</span>] &#125; &#125; )</span><br><span class="line"></span><br><span class="line">// 查询<span class="keyword">tags</span> 里面包含 <span class="keyword">red</span>的数据</span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; <span class="keyword">tag</span><span class="variable">s:</span> <span class="string">"red"</span> &#125; )</span><br><span class="line"></span><br><span class="line">// 查询dim_cm里面最少有一个值大于 <span class="number">25</span></span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; dim_cm: &#123; $g<span class="variable">t:</span> <span class="number">25</span> &#125; &#125; )</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">** 查询dim_cm里面:</span><br><span class="line">** <span class="number">1</span>. 有一个元素同时满足大于<span class="number">15</span>并且小于<span class="number">20</span></span><br><span class="line">** <span class="number">2</span>. 有两个分别满足小于<span class="number">15</span>以及大于<span class="number">20</span></span><br><span class="line">*/</span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; dim_cm: &#123; $g<span class="variable">t:</span> <span class="number">15</span>, $<span class="keyword">l</span><span class="variable">t:</span> <span class="number">20</span> &#125; &#125; )</span><br><span class="line">// 所以结果是返回这四条：</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"journal"</span>, <span class="string">"qty"</span> : <span class="number">25</span>, <span class="string">"tags"</span> : [ <span class="string">"blank"</span>, <span class="string">"red"</span> ], <span class="string">"dim_cm"</span> : [ <span class="number">14</span>, <span class="number">21</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"notebook"</span>, <span class="string">"qty"</span> : <span class="number">50</span>, <span class="string">"tags"</span> : [ <span class="string">"red"</span>, <span class="string">"blank"</span> ], <span class="string">"dim_cm"</span> : [ <span class="number">14</span>, <span class="number">21</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"paper"</span>, <span class="string">"qty"</span> : <span class="number">100</span>, <span class="string">"tags"</span> : [ <span class="string">"red"</span>, <span class="string">"blank"</span>, <span class="string">"plain"</span> ], <span class="string">"dim_cm"</span> : [ <span class="number">14</span>, <span class="number">21</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"postcard"</span>, <span class="string">"qty"</span> : <span class="number">45</span>, <span class="string">"tags"</span> : [ <span class="string">"blue"</span> ], <span class="string">"dim_cm"</span> : [ <span class="number">10</span>, <span class="number">15.25</span> ] &#125;</span><br><span class="line"></span><br><span class="line">// 查询dim_cm里面至少有一个元素同时满足大于<span class="number">22</span>并且小于<span class="number">30</span>的数据</span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; dim_cm: &#123; $elemMatch: &#123; $g<span class="variable">t:</span> <span class="number">22</span>, $<span class="keyword">l</span><span class="variable">t:</span> <span class="number">30</span> &#125; &#125; &#125; )</span><br><span class="line"></span><br><span class="line">// 查询dim_cm第二个元素大于<span class="number">25</span>的数据</span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; <span class="string">"dim_cm.1"</span>: &#123; $g<span class="variable">t:</span> <span class="number">25</span> &#125; &#125; )</span><br><span class="line"></span><br><span class="line">// 查询dim_cm的<span class="keyword">tags</span>数组长度为<span class="number">3</span>的数据</span><br><span class="line">db.inventory.<span class="keyword">find</span>( &#123; <span class="string">"tags"</span>: &#123; $size: <span class="number">3</span> &#125; &#125; )</span><br></pre></td></tr></table></figure>

<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例数据</span></span><br><span class="line">db.inventory.insertMany( [</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"journal"</span>, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">5</span> &#125;, &#123; <span class="string">warehouse:</span> <span class="string">"C"</span>, <span class="string">qty:</span> <span class="number">15</span> &#125; ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"notebook"</span>, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"C"</span>, <span class="string">qty:</span> <span class="number">5</span> &#125; ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"paper"</span>, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">60</span> &#125;, &#123; <span class="string">warehouse:</span> <span class="string">"B"</span>, <span class="string">qty:</span> <span class="number">15</span> &#125; ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"planner"</span>, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">40</span> &#125;, &#123; <span class="string">warehouse:</span> <span class="string">"B"</span>, <span class="string">qty:</span> <span class="number">5</span> &#125; ] &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"postcard"</span>, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"B"</span>, <span class="string">qty:</span> <span class="number">15</span> &#125;, &#123; <span class="string">warehouse:</span> <span class="string">"C"</span>, <span class="string">qty:</span> <span class="number">35</span> &#125; ] &#125;</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询instock数组里面有一个元素为&#123; warehouse: "A", qty: 5 &#125;的数据，必须warehouse等于A并且qty等于5，包括顺序也必须一致</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">"instock"</span>: &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">5</span> &#125; &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询instock数组里面至少有一个元素的qty字段值小于等于20的数组</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">'instock.qty'</span>: &#123; <span class="string">$lte:</span> <span class="number">20</span> &#125; &#125; )</span><br><span class="line"><span class="comment">// 结果为：</span></span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"journal"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">5</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"C"</span>, <span class="string">"qty"</span> : <span class="number">15</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"notebook"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"C"</span>, <span class="string">"qty"</span> : <span class="number">5</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"paper"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">60</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"B"</span>, <span class="string">"qty"</span> : <span class="number">15</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"planner"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">40</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"B"</span>, <span class="string">"qty"</span> : <span class="number">5</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"postcard"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"B"</span>, <span class="string">"qty"</span> : <span class="number">15</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"C"</span>, <span class="string">"qty"</span> : <span class="number">35</span> &#125; ] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询instock数组的第一个元素的qty字段小于等于20的数据</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">'instock.0.qty'</span>: &#123; <span class="string">$lte:</span> <span class="number">20</span> &#125; &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询instock数组里至少有一个元素同时满足qty等于5并且warehouse等于A的数组</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">"instock"</span>: &#123; <span class="string">$elemMatch:</span> &#123; <span class="string">qty:</span> <span class="number">5</span>, <span class="string">warehouse:</span> <span class="string">"A"</span> &#125; &#125; &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询instock数组里至少有一个元素的qty同时满足大于10并且小于等于20</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">"instock"</span>: &#123; <span class="string">$elemMatch:</span> &#123; <span class="string">qty:</span> &#123; <span class="string">$gt:</span> <span class="number">10</span>, <span class="string">$lte:</span> <span class="number">20</span> &#125; &#125; &#125; &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询instock数组里至少有一个元素满足大于10或者小于等于20</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">"instock.qty"</span>: &#123; <span class="string">$gt:</span> <span class="number">10</span>,  <span class="string">$lte:</span> <span class="number">20</span> &#125; &#125; )</span><br><span class="line"><span class="comment">// 结果为：</span></span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"journal"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">5</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"C"</span>, <span class="string">"qty"</span> : <span class="number">15</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"paper"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">60</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"B"</span>, <span class="string">"qty"</span> : <span class="number">15</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"planner"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">40</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"B"</span>, <span class="string">"qty"</span> : <span class="number">5</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"postcard"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"B"</span>, <span class="string">"qty"</span> : <span class="number">15</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"C"</span>, <span class="string">"qty"</span> : <span class="number">35</span> &#125; ] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询instock里任意一个元素的qty等于5并且任意一个元素的warehouse等于A的数据</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">"instock.qty"</span>: <span class="number">5</span>, <span class="string">"instock.warehouse"</span>: <span class="string">"A"</span> &#125; )</span><br><span class="line"><span class="comment">// 结果为：</span></span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"journal"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">5</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"C"</span>, <span class="string">"qty"</span> : <span class="number">15</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"item"</span> : <span class="string">"planner"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"warehouse"</span> : <span class="string">"A"</span>, <span class="string">"qty"</span> : <span class="number">40</span> &#125;, &#123; <span class="string">"warehouse"</span> : <span class="string">"B"</span>, <span class="string">"qty"</span> : <span class="number">5</span> &#125; ] &#125;</span><br></pre></td></tr></table></figure>

<h3 id="控制查询语句输出结果"><a href="#控制查询语句输出结果" class="headerlink" title="控制查询语句输出结果"></a>控制查询语句输出结果</h3><p>默认情况下，查询语句会返回文档的所有字段，我们可以通过第二个参数来自定义返回文档里的哪些字段</p>
<p>关于第一个参数，我们这里就不详细说明了，可参考上面</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例数据</span></span><br><span class="line">db.inventory.insertMany( [</span><br><span class="line">  &#123; <span class="string">item:</span> <span class="string">"journal"</span>, <span class="string">status:</span> <span class="string">"A"</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">14</span>, <span class="string">w:</span> <span class="number">21</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">5</span> &#125; ] &#125;,</span><br><span class="line">  &#123; <span class="string">item:</span> <span class="string">"notebook"</span>, <span class="string">status:</span> <span class="string">"A"</span>,  <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">8.5</span>, <span class="string">w:</span> <span class="number">11</span>, <span class="string">uom:</span> <span class="string">"in"</span> &#125;, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"C"</span>, <span class="string">qty:</span> <span class="number">5</span> &#125; ] &#125;,</span><br><span class="line">  &#123; <span class="string">item:</span> <span class="string">"paper"</span>, <span class="string">status:</span> <span class="string">"D"</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">8.5</span>, <span class="string">w:</span> <span class="number">11</span>, <span class="string">uom:</span> <span class="string">"in"</span> &#125;, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">60</span> &#125; ] &#125;,</span><br><span class="line">  &#123; <span class="string">item:</span> <span class="string">"planner"</span>, <span class="string">status:</span> <span class="string">"D"</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">22.85</span>, <span class="string">w:</span> <span class="number">30</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">40</span> &#125; ] &#125;,</span><br><span class="line">  &#123; <span class="string">item:</span> <span class="string">"postcard"</span>, <span class="string">status:</span> <span class="string">"A"</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">10</span>, <span class="string">w:</span> <span class="number">15.25</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"B"</span>, <span class="string">qty:</span> <span class="number">15</span> &#125;, &#123; <span class="string">warehouse:</span> <span class="string">"C"</span>, <span class="string">qty:</span> <span class="number">35</span> &#125; ] &#125;</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回所有文档的status为的A的数据的所有字段</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只返回文档的item, status字段以及_id（默认显示），1代表显示，0则是不显示</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125;, &#123; <span class="string">item:</span> <span class="number">1</span>, <span class="string">status:</span> <span class="number">1</span> &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果想要_id也不返回，可以这样：</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125;, &#123; <span class="string">item:</span> <span class="number">1</span>, <span class="string">status:</span> <span class="number">1</span>, <span class="string">_id:</span> <span class="number">0</span> &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以单独给某些不想显示的字段设为0，其余的正常显示</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125;, &#123; <span class="string">status:</span> <span class="number">0</span>, <span class="string">instock:</span> <span class="number">0</span> &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还可以控制嵌套对象的字段，下面语句只显示_id, item, status, 以及size的uom字段</span></span><br><span class="line">db.inventory.find(</span><br><span class="line">   &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="number">1</span>, <span class="string">status:</span> <span class="number">1</span>, <span class="string">"size.uom"</span>: <span class="number">1</span> &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以只设置不显示某个嵌套字段，下面语句不显示size的uom属性，其余正常显示</span></span><br><span class="line">db.inventory.find(</span><br><span class="line">   &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">"size.uom"</span>: <span class="number">0</span> &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制数组中的元素某些字段是否显示</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125;, &#123; <span class="string">item:</span> <span class="number">1</span>, <span class="string">status:</span> <span class="number">1</span>, <span class="string">"instock.qty"</span>: <span class="number">1</span> &#125; )</span><br><span class="line"><span class="comment">// 结果为：</span></span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5e639b35940e1ec922af0d51"</span>), <span class="string">"item"</span> : <span class="string">"journal"</span>, <span class="string">"status"</span> : <span class="string">"A"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"qty"</span> : <span class="number">5</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5e639b35940e1ec922af0d52"</span>), <span class="string">"item"</span> : <span class="string">"notebook"</span>, <span class="string">"status"</span> : <span class="string">"A"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"qty"</span> : <span class="number">5</span> &#125; ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5e639b35940e1ec922af0d55"</span>), <span class="string">"item"</span> : <span class="string">"postcard"</span>, <span class="string">"status"</span> : <span class="string">"A"</span>, <span class="string">"instock"</span> : [ &#123; <span class="string">"qty"</span> : <span class="number">15</span> &#125;, &#123; <span class="string">"qty"</span> : <span class="number">35</span> &#125; ] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于instock，只返回数组的最后一个元素</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">status:</span> <span class="string">"A"</span> &#125;, &#123; <span class="string">item:</span> <span class="number">1</span>, <span class="string">status:</span> <span class="number">1</span>, <span class="string">instock:</span> &#123; <span class="string">$slice:</span> <span class="number">-1</span> &#125; &#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment">// $elemMatch, $slice 和 $ 是唯一能控制数组返回字段的方法，在这里，不可以使用类似于：&#123; 'instock.0': 1 &#125;这种控制只显示instock数组的第一个元素的。</span></span><br></pre></td></tr></table></figure>

<h3 id="如何显示null或者缺失字段"><a href="#如何显示null或者缺失字段" class="headerlink" title="如何显示null或者缺失字段"></a>如何显示null或者缺失字段</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例数据</span></span><br><span class="line">db.inventory.insertMany([</span><br><span class="line">   &#123; <span class="string">_id:</span> <span class="number">1</span>, <span class="string">item:</span> <span class="literal">null</span> &#125;,</span><br><span class="line">   &#123; <span class="string">_id:</span> <span class="number">2</span> &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// item设为null时，会返回null，以及不存在该字段的数据，比如第二条数据不存在item字段，也会被返回</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">item:</span> <span class="literal">null</span> &#125; )</span><br><span class="line"><span class="comment">// 结果为：</span></span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="number">1</span>, <span class="string">"item"</span> : <span class="literal">null</span> &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="number">2</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果想要精确匹配，可以这样：</span></span><br><span class="line"><span class="comment">// 10 是Null类型的数值表示，具体可看：https://docs.mongodb.com/manual/reference/bson-types/，里面有各种类型对应的数值</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">item :</span> &#123; <span class="string">$type:</span> <span class="number">10</span> &#125; &#125; )</span><br><span class="line"><span class="comment">// 结果为：</span></span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="number">1</span>, <span class="string">"item"</span> : <span class="literal">null</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还可以使用$exists操作符，用于标明字段是否存在</span></span><br><span class="line">db.inventory.find( &#123; <span class="string">item :</span> &#123; <span class="string">$exists:</span> <span class="literal">false</span> &#125; &#125; )</span><br><span class="line"><span class="comment">// 结果为：</span></span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="number">2</span> &#125;</span><br><span class="line"><span class="comment">// 如果$exists设为true，则返回：</span></span><br><span class="line">&#123; <span class="string">"_id"</span> : <span class="number">1</span>, <span class="string">"item"</span> : <span class="literal">null</span> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用游标操作数据"><a href="#使用游标操作数据" class="headerlink" title="使用游标操作数据"></a>使用游标操作数据</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以将find的返回值保存到一个变量中</span></span><br><span class="line"><span class="keyword">var</span> myCursor = <span class="keyword">db</span>.users.find( &#123; <span class="keyword">type</span>: 2 &#125; );</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (myCursor.hasNext()) &#123;</span><br><span class="line">   <span class="keyword">print</span>(tojson(myCursor.next()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以使用printjson代替print(tojson()</span></span><br><span class="line"><span class="keyword">var</span> myCursor = <span class="keyword">db</span>.users.find( &#123; <span class="keyword">type</span>: 2 &#125; );</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (myCursor.hasNext()) &#123;</span><br><span class="line">   printjson(myCursor.next());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还可以使用游标的forEach方法</span></span><br><span class="line"><span class="keyword">var</span> myCursor =  <span class="keyword">db</span>.users.find( &#123; <span class="keyword">type</span>: 2 &#125; );</span><br><span class="line"></span><br><span class="line">myCursor.<span class="keyword">forEach</span>(printjson);</span><br></pre></td></tr></table></figure>

<p>游标对象的具体有哪些方法可以看：<a href="https://docs.mongodb.com/manual/reference/method/#js-query-cursor-methods" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/method/#js-query-cursor-methods</a></p>
<h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><p>更新数据主要使用：</p>
<ul>
<li><code>db.collection.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></li>
<li><code>db.collection.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></li>
<li><code>db.collection.replaceOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></li>
</ul>
<p>mongodb提供了更新操作符去更新数据，比如$set，具体可看文档：<a href="https://docs.mongodb.com/manual/reference/operator/update/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/operator/update/</a></p>
<p>有一些操作符，比如$set在字段不存在时会自动添加该字段</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例数据</span></span><br><span class="line">db.inventory.insertMany( [</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"canvas"</span>, <span class="string">qty:</span> <span class="number">100</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">28</span>, <span class="string">w:</span> <span class="number">35.5</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"journal"</span>, <span class="string">qty:</span> <span class="number">25</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">14</span>, <span class="string">w:</span> <span class="number">21</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"mat"</span>, <span class="string">qty:</span> <span class="number">85</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">27.9</span>, <span class="string">w:</span> <span class="number">35.5</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"mousepad"</span>, <span class="string">qty:</span> <span class="number">25</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">19</span>, <span class="string">w:</span> <span class="number">22.85</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"P"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"notebook"</span>, <span class="string">qty:</span> <span class="number">50</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">8.5</span>, <span class="string">w:</span> <span class="number">11</span>, <span class="string">uom:</span> <span class="string">"in"</span> &#125;, <span class="string">status:</span> <span class="string">"P"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"paper"</span>, <span class="string">qty:</span> <span class="number">100</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">8.5</span>, <span class="string">w:</span> <span class="number">11</span>, <span class="string">uom:</span> <span class="string">"in"</span> &#125;, <span class="string">status:</span> <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"planner"</span>, <span class="string">qty:</span> <span class="number">75</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">22.85</span>, <span class="string">w:</span> <span class="number">30</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"postcard"</span>, <span class="string">qty:</span> <span class="number">45</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">10</span>, <span class="string">w:</span> <span class="number">15.25</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"sketchbook"</span>, <span class="string">qty:</span> <span class="number">80</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">14</span>, <span class="string">w:</span> <span class="number">21</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"sketch pad"</span>, <span class="string">qty:</span> <span class="number">95</span>, <span class="string">size:</span> &#123; <span class="string">h:</span> <span class="number">22.85</span>, <span class="string">w:</span> <span class="number">30.5</span>, <span class="string">uom:</span> <span class="string">"cm"</span> &#125;, <span class="string">status:</span> <span class="string">"A"</span> &#125;</span><br><span class="line">] );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数这里也不继续说明了，详细可以看上面查询部分</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** 1. 更新size的uom字段值为cm</span></span><br><span class="line"><span class="comment">** 2. 更新status字段值为P</span></span><br><span class="line"><span class="comment">** 3. 更新lastModified为当前时间，如果lastModified字段不存在，会添加该字段</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">db.inventory.updateOne(</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"paper"</span> &#125;,</span><br><span class="line">   &#123;</span><br><span class="line"><span class="symbol">     $set:</span> &#123; <span class="string">"size.uom"</span>: <span class="string">"cm"</span>, <span class="string">status:</span> <span class="string">"P"</span> &#125;,</span><br><span class="line"><span class="symbol">     $currentDate:</span> &#123; <span class="string">lastModified:</span> <span class="literal">true</span> &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment">// 更新后的数据：</span></span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5e6466a4940e1ec922af0d5b"</span>), <span class="string">"item"</span> : <span class="string">"paper"</span>, <span class="string">"qty"</span> : <span class="number">100</span>, <span class="string">"size"</span> : &#123; <span class="string">"h"</span> : <span class="number">8.5</span>, <span class="string">"w"</span> : <span class="number">11</span>, <span class="string">"uom"</span> : <span class="string">"cm"</span> &#125;, <span class="string">"status"</span> : <span class="string">"P"</span>, <span class="string">"lastModified"</span> : ISODate(<span class="string">"2020-03-08T03:29:48.653Z"</span>) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新多条数据</span></span><br><span class="line">db.inventory.updateMany(</span><br><span class="line">   &#123; <span class="string">"qty"</span>: &#123; <span class="string">$lt:</span> <span class="number">50</span> &#125; &#125;,</span><br><span class="line">   &#123;</span><br><span class="line"><span class="symbol">     $set:</span> &#123; <span class="string">"size.uom"</span>: <span class="string">"in"</span>, <span class="string">status:</span> <span class="string">"P"</span> &#125;,</span><br><span class="line"><span class="symbol">     $currentDate:</span> &#123; <span class="string">lastModified:</span> <span class="literal">true</span> &#125;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** 替换数据</span></span><br><span class="line"><span class="comment">** 1. _id字段不能被替换，如果新数据里包含_id字段，则值必须和原数据的一致</span></span><br><span class="line"><span class="comment">** 2. 新数据不能包含操作符</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">db.inventory.replaceOne(</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"paper"</span> &#125;,</span><br><span class="line">   &#123; <span class="string">item:</span> <span class="string">"paper"</span>, <span class="string">instock:</span> [ &#123; <span class="string">warehouse:</span> <span class="string">"A"</span>, <span class="string">qty:</span> <span class="number">60</span> &#125;, &#123; <span class="string">warehouse:</span> <span class="string">"B"</span>, <span class="string">qty:</span> <span class="number">40</span> &#125; ] &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>upsert</code>属性<br>如果<code>updateOne()</code>, <code>updateMany()</code> 或者 <code>replaceOne()</code>包含<code>upsert: true</code>参数时，如果这三个方法没有匹配到任何文档，则会创建一个新的插入到集合中，如果匹配到了，则会修改或者替换原文档。</p>
<h3 id="使用聚合更新数据"><a href="#使用聚合更新数据" class="headerlink" title="使用聚合更新数据"></a>使用聚合更新数据</h3><p>在聚合中可以使用一下更新操作符：</p>
<ul>
<li>$addFields</li>
<li>$set</li>
<li>$project</li>
<li>$unset</li>
<li>$replaceRoot</li>
<li>$replaceWith</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">示例数据</span></span><br><span class="line"><span class="string">db.students.insertMany([</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="attr">_id:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">test1:</span> <span class="number">95</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">92</span><span class="string">,</span> <span class="attr">test3:</span> <span class="number">90</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">new</span> <span class="string">Date("01/05/2020")</span> <span class="string">&#125;,</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="attr">_id:</span> <span class="number">2</span><span class="string">,</span> <span class="attr">test1:</span> <span class="number">98</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">100</span><span class="string">,</span> <span class="attr">test3:</span> <span class="number">102</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">new</span> <span class="string">Date("01/05/2020")</span> <span class="string">&#125;,</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="attr">_id:</span> <span class="number">3</span><span class="string">,</span> <span class="attr">test1:</span> <span class="number">95</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">110</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">new</span> <span class="string">Date("01/04/2020")</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">])</span></span><br><span class="line"></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">**</span> <span class="string">updateOne方法第二个参数可以是以数组，里面可以有多种操作</span></span><br><span class="line"><span class="string">**</span> <span class="number">1</span><span class="string">.</span> <span class="string">新增一个test3字段并设为98</span></span><br><span class="line"><span class="string">**</span> <span class="number">2</span><span class="string">.</span> <span class="string">修改modified数据值为当前时间</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">db.students.updateOne(</span> <span class="string">&#123;</span> <span class="attr">_id:</span> <span class="number">3</span> <span class="string">&#125;,</span> <span class="string">[</span> <span class="string">&#123;</span> <span class="string">$set:</span> <span class="string">&#123;</span> <span class="attr">"test3":</span> <span class="number">98</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">"$$NOW"</span><span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">]</span> <span class="string">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">示例数据</span></span><br><span class="line"><span class="string">db.students2.insertMany([</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">quiz1:</span> <span class="number">8</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">100</span><span class="string">,</span> <span class="attr">quiz2:</span> <span class="number">9</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">new</span> <span class="string">Date("01/05/2020")</span> <span class="string">&#125;,</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="attr">quiz2:</span> <span class="number">5</span><span class="string">,</span> <span class="attr">test1:</span> <span class="number">80</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">89</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">new</span> <span class="string">Date("01/05/2020")</span> <span class="string">&#125;,</span></span><br><span class="line"><span class="string">])</span></span><br><span class="line"></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">**</span> <span class="string">同时执行多个操作，首先序列化所有文档（集合中的每个文档字段可能并不一致），再更新modified字段</span></span><br><span class="line"><span class="string">**</span> <span class="number">1</span><span class="string">.</span> <span class="string">序列化文档，如果文档中没有</span> <span class="string">quiz1</span> <span class="string">or</span> <span class="string">quiz2</span> <span class="string">or</span> <span class="string">test1</span> <span class="string">or</span> <span class="string">test2</span> <span class="string">就给它添加该字段，并将值设为0。该操作可以用于将集合中所有文档的字段保持一致</span></span><br><span class="line"><span class="string">**</span> <span class="number">2</span><span class="string">.</span> <span class="string">更新文档的modified为当前时间</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">db.students2.updateMany(</span> <span class="string">&#123;&#125;,</span></span><br><span class="line">  <span class="string">[</span></span><br><span class="line">    <span class="string">&#123;</span> <span class="string">$replaceRoot:</span> <span class="string">&#123;</span> <span class="attr">newRoot:</span></span><br><span class="line">       <span class="string">&#123;</span> <span class="string">$mergeObjects:</span> <span class="string">[</span> <span class="string">&#123;</span> <span class="attr">quiz1:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">quiz2:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">test1:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">0</span> <span class="string">&#125;,</span> <span class="string">"$$ROOT"</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span> <span class="string">&#125;,</span></span><br><span class="line">    <span class="string">&#123;</span> <span class="string">$set:</span> <span class="string">&#123;</span> <span class="attr">modified:</span> <span class="string">"$$NOW"</span><span class="string">&#125;</span>  <span class="string">&#125;</span></span><br><span class="line">  <span class="string">]</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">//</span> <span class="string">结果为：</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">1</span><span class="string">,</span> <span class="attr">quiz1:</span> <span class="number">8</span><span class="string">,</span> <span class="attr">quiz2:</span> <span class="number">9</span><span class="string">,</span> <span class="attr">test1:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">100</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">new</span> <span class="string">Date("01/05/2020")</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="attr">quiz1:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">quiz2:</span> <span class="number">5</span><span class="string">,</span> <span class="attr">test1:</span> <span class="number">80</span><span class="string">,</span> <span class="attr">test2:</span> <span class="number">89</span><span class="string">,</span> <span class="attr">modified:</span> <span class="string">new</span> <span class="string">Date("01/05/2020")</span> <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">示例数据</span></span><br><span class="line"><span class="string">db.students3.insert([</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">1</span><span class="string">,</span> <span class="string">"tests"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">95</span><span class="string">,</span> <span class="number">92</span><span class="string">,</span> <span class="number">90</span> <span class="string">],</span> <span class="string">"modified"</span> <span class="string">:</span> <span class="string">ISODate("2019-01-01T00:00:00Z")</span> <span class="string">&#125;,</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="string">"tests"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">94</span><span class="string">,</span> <span class="number">88</span><span class="string">,</span> <span class="number">90</span> <span class="string">],</span> <span class="string">"modified"</span> <span class="string">:</span> <span class="string">ISODate("2019-01-01T00:00:00Z")</span> <span class="string">&#125;,</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">3</span><span class="string">,</span> <span class="string">"tests"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">70</span><span class="string">,</span> <span class="number">75</span><span class="string">,</span> <span class="number">82</span> <span class="string">],</span> <span class="string">"modified"</span> <span class="string">:</span> <span class="string">ISODate("2019-01-01T00:00:00Z")</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">]);</span></span><br><span class="line"></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">**</span> <span class="string">设置average,</span> <span class="string">grade字段值，并且修改modified值</span></span><br><span class="line"><span class="string">**</span> <span class="number">1.1</span> <span class="string">设置average字段（如果没有会新增）为tests数组的平均值，0代表保留0个小数，即取证，具体可看$trunc操作符文档https://docs.mongodb.com/manual/reference/operator/aggregation/trunc/</span></span><br><span class="line"><span class="string">**</span> <span class="number">1.2</span> <span class="string">设置modifed字段为当前时间</span></span><br><span class="line"><span class="string">**</span> <span class="number">1</span> <span class="string">设置grade字段，根据average的值分别设为A,B,C,D,F</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">db.students3.updateMany(</span></span><br><span class="line">   <span class="string">&#123;</span> <span class="string">&#125;,</span></span><br><span class="line">   <span class="string">[</span></span><br><span class="line">     <span class="string">&#123;</span> <span class="string">$set:</span> <span class="string">&#123;</span> <span class="attr">average :</span> <span class="string">&#123;</span> <span class="string">$trunc:</span> <span class="string">[</span> <span class="string">&#123;</span> <span class="string">$avg:</span> <span class="string">"$tests"</span> <span class="string">&#125;,</span> <span class="number">0</span> <span class="string">]</span> <span class="string">&#125;,</span> <span class="attr">modified:</span> <span class="string">"$$NOW"</span> <span class="string">&#125;</span> <span class="string">&#125;,</span></span><br><span class="line">     <span class="string">&#123;</span> <span class="string">$set:</span> <span class="string">&#123;</span> <span class="attr">grade:</span> <span class="string">&#123;</span> <span class="string">$switch:</span> <span class="string">&#123;</span></span><br><span class="line">                           <span class="attr">branches:</span> <span class="string">[</span></span><br><span class="line">                               <span class="string">&#123;</span> <span class="attr">case:</span> <span class="string">&#123;</span> <span class="string">$gte:</span> <span class="string">[</span> <span class="string">"$average"</span><span class="string">,</span> <span class="number">90</span> <span class="string">]</span> <span class="string">&#125;,</span> <span class="attr">then:</span> <span class="string">"A"</span> <span class="string">&#125;,</span></span><br><span class="line">                               <span class="string">&#123;</span> <span class="attr">case:</span> <span class="string">&#123;</span> <span class="string">$gte:</span> <span class="string">[</span> <span class="string">"$average"</span><span class="string">,</span> <span class="number">80</span> <span class="string">]</span> <span class="string">&#125;,</span> <span class="attr">then:</span> <span class="string">"B"</span> <span class="string">&#125;,</span></span><br><span class="line">                               <span class="string">&#123;</span> <span class="attr">case:</span> <span class="string">&#123;</span> <span class="string">$gte:</span> <span class="string">[</span> <span class="string">"$average"</span><span class="string">,</span> <span class="number">70</span> <span class="string">]</span> <span class="string">&#125;,</span> <span class="attr">then:</span> <span class="string">"C"</span> <span class="string">&#125;,</span></span><br><span class="line">                               <span class="string">&#123;</span> <span class="attr">case:</span> <span class="string">&#123;</span> <span class="string">$gte:</span> <span class="string">[</span> <span class="string">"$average"</span><span class="string">,</span> <span class="number">60</span> <span class="string">]</span> <span class="string">&#125;,</span> <span class="attr">then:</span> <span class="string">"D"</span> <span class="string">&#125;</span></span><br><span class="line">                           <span class="string">],</span></span><br><span class="line">                           <span class="attr">default:</span> <span class="string">"F"</span></span><br><span class="line">     <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">&#125;</span></span><br><span class="line">   <span class="string">]</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">//</span> <span class="string">结果为：</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">1</span><span class="string">,</span> <span class="string">"tests"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">95</span><span class="string">,</span> <span class="number">92</span><span class="string">,</span> <span class="number">90</span> <span class="string">],</span> <span class="attr">"average":</span> <span class="number">92</span><span class="string">,</span> <span class="attr">"grade":</span> <span class="string">"A"</span><span class="string">,</span> <span class="string">"modified"</span> <span class="string">:</span> <span class="string">ISODate("2019-01-01T00:00:00Z")</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="string">"tests"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">94</span><span class="string">,</span> <span class="number">88</span><span class="string">,</span> <span class="number">90</span> <span class="string">],</span> <span class="attr">"average":</span> <span class="number">90</span><span class="string">,</span> <span class="attr">"grade":</span> <span class="string">"A"</span><span class="string">,</span> <span class="string">"modified"</span> <span class="string">:</span> <span class="string">ISODate("2019-01-01T00:00:00Z")</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">3</span><span class="string">,</span> <span class="string">"tests"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">70</span><span class="string">,</span> <span class="number">75</span><span class="string">,</span> <span class="number">82</span> <span class="string">],</span> <span class="attr">"average":</span> <span class="number">75</span><span class="string">,</span> <span class="attr">"grade":</span> <span class="string">"C"</span><span class="string">,</span> <span class="string">"modified"</span> <span class="string">:</span> <span class="string">ISODate("2019-01-01T00:00:00Z")</span> <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">示例数据</span></span><br><span class="line"><span class="string">db.students4.insertMany([</span></span><br><span class="line">  <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">1</span><span class="string">,</span> <span class="string">"quizzes"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">4</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">7</span> <span class="string">]</span> <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="string">"quizzes"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">5</span> <span class="string">]</span> <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">3</span><span class="string">,</span> <span class="string">"quizzes"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">10</span><span class="string">,</span> <span class="number">10</span><span class="string">,</span> <span class="number">10</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">])</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">在quizzes后追加[8,</span> <span class="number">6</span><span class="string">]</span></span><br><span class="line"><span class="string">db.students4.updateOne(</span> <span class="string">&#123;</span> <span class="attr">_id:</span> <span class="number">2</span> <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">[</span> <span class="string">&#123;</span> <span class="string">$set:</span> <span class="string">&#123;</span> <span class="attr">quizzes:</span> <span class="string">&#123;</span> <span class="string">$concatArrays:</span> <span class="string">[</span> <span class="string">"$quizzes"</span><span class="string">,</span> <span class="string">[</span> <span class="number">8</span><span class="string">,</span> <span class="number">6</span> <span class="string">]</span>  <span class="string">]</span> <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">]</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">//</span> <span class="string">结果为</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="string">"quizzes"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">5</span><span class="string">,</span> <span class="number">8</span><span class="string">,</span> <span class="number">6</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">示例数据</span></span><br><span class="line"><span class="string">db.temperatures.insertMany([</span></span><br><span class="line">  <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">1</span><span class="string">,</span> <span class="string">"date"</span> <span class="string">:</span> <span class="string">ISODate("2019-06-23"),</span> <span class="string">"tempsC"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">4</span><span class="string">,</span> <span class="number">12</span><span class="string">,</span> <span class="number">17</span> <span class="string">]</span> <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="string">"date"</span> <span class="string">:</span> <span class="string">ISODate("2019-07-07"),</span> <span class="string">"tempsC"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">14</span><span class="string">,</span> <span class="number">24</span><span class="string">,</span> <span class="number">11</span> <span class="string">]</span> <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">3</span><span class="string">,</span> <span class="string">"date"</span> <span class="string">:</span> <span class="string">ISODate("2019-10-30"),</span> <span class="string">"tempsC"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">18</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">8</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">])</span></span><br><span class="line"></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">**</span> <span class="number">1</span><span class="string">.</span> <span class="string">新增tempsF字段</span></span><br><span class="line"><span class="string">**</span> <span class="number">2</span><span class="string">.</span> <span class="string">将tempsC数组里的摄氏度转换为华氏度</span> <span class="string">f</span> <span class="string">=</span> <span class="string">c</span> <span class="string">*</span> <span class="number">1.8</span> <span class="string">+</span> <span class="number">32</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">db.temperatures.updateMany(</span> <span class="string">&#123;</span> <span class="string">&#125;,</span></span><br><span class="line">  <span class="string">[</span></span><br><span class="line">    <span class="string">&#123;</span> <span class="string">$addFields:</span> <span class="string">&#123;</span> <span class="attr">"tempsF":</span> <span class="string">&#123;</span></span><br><span class="line">          <span class="string">$map:</span> <span class="string">&#123;</span></span><br><span class="line">             <span class="attr">input:</span> <span class="string">"$tempsC"</span><span class="string">,</span></span><br><span class="line">             <span class="attr">as:</span> <span class="string">"celsius"</span><span class="string">,</span></span><br><span class="line">             <span class="attr">in:</span> <span class="string">&#123;</span> <span class="string">$add:</span> <span class="string">[</span> <span class="string">&#123;</span> <span class="string">$multiply:</span> <span class="string">["$$celsius",</span> <span class="number">9</span><span class="string">/5</span> <span class="string">]</span> <span class="string">&#125;,</span> <span class="number">32</span> <span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line">          <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">&#125;</span></span><br><span class="line">  <span class="string">]</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">//</span> <span class="string">结果为：</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">1</span><span class="string">,</span> <span class="string">"date"</span> <span class="string">:</span> <span class="string">ISODate("2019-06-23"),</span> <span class="string">"tempsC"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">4</span><span class="string">,</span> <span class="number">12</span><span class="string">,</span> <span class="number">17</span> <span class="string">],</span> <span class="attr">"tempsF":</span> <span class="string">[39.2,</span> <span class="number">53.6</span><span class="string">,</span> <span class="number">62.6</span><span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">2</span><span class="string">,</span> <span class="string">"date"</span> <span class="string">:</span> <span class="string">ISODate("2019-07-07"),</span> <span class="string">"tempsC"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">14</span><span class="string">,</span> <span class="number">24</span><span class="string">,</span> <span class="number">11</span> <span class="string">],</span> <span class="attr">"tempsF":</span> <span class="string">[57.2,</span> <span class="number">75.2</span><span class="string">,</span> <span class="number">51.8</span><span class="string">]</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#123;</span> <span class="string">"_id"</span> <span class="string">:</span> <span class="number">3</span><span class="string">,</span> <span class="string">"date"</span> <span class="string">:</span> <span class="string">ISODate("2019-10-30"),</span> <span class="string">"tempsC"</span> <span class="string">:</span> <span class="string">[</span> <span class="number">18</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">8</span> <span class="string">],</span> <span class="attr">"tempsF":</span> <span class="string">[64.4,</span> <span class="number">42.8</span><span class="string">,</span> <span class="number">46.4</span><span class="string">]</span> <span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="update方法"><a href="#update方法" class="headerlink" title="update方法"></a>update方法</h3><p>具体可看文档：<a href="https://docs.mongodb.com/manual/reference/update-methods/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/update-methods/</a></p>
<ul>
<li><p><code>db.collection.updateOne()</code></p>
</li>
<li><p><code>db.collection.updateMany()</code></p>
</li>
<li><p><code>db.collection.replaceOne()</code></p>
</li>
<li><p><code>db.collection.update()</code></p>
</li>
<li><p><code>db.collection.findOneAndReplace()</code></p>
</li>
<li><p><code>db.collection.findOneAndUpdate()</code></p>
</li>
<li><p><code>db.collection.findAndModify()</code></p>
</li>
<li><p><code>db.collection.save()</code></p>
</li>
<li><p><code>db.collection.bulkWrite()</code></p>
</li>
</ul>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>可以使用下面方法删除数据</p>
<ul>
<li><code>db.collection.deleteMany()</code></li>
<li><code>db.collection.deleteOne()</code></li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例数据</span></span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.inventory</span><span class="selector-class">.insertMany</span>( [</span><br><span class="line">   &#123; <span class="attribute">item</span>: <span class="string">"journal"</span>, <span class="attribute">qty</span>: <span class="number">25</span>, <span class="attribute">size</span>: &#123; <span class="attribute">h</span>: <span class="number">14</span>, <span class="attribute">w</span>: <span class="number">21</span>, <span class="attribute">uom</span>: <span class="string">"cm"</span> &#125;, <span class="attribute">status</span>: <span class="string">"A"</span> &#125;,</span><br><span class="line">   &#123; <span class="attribute">item</span>: <span class="string">"notebook"</span>, <span class="attribute">qty</span>: <span class="number">50</span>, <span class="attribute">size</span>: &#123; <span class="attribute">h</span>: <span class="number">8.5</span>, <span class="attribute">w</span>: <span class="number">11</span>, <span class="attribute">uom</span>: <span class="string">"in"</span> &#125;, <span class="attribute">status</span>: <span class="string">"P"</span> &#125;,</span><br><span class="line">   &#123; <span class="attribute">item</span>: <span class="string">"paper"</span>, <span class="attribute">qty</span>: <span class="number">100</span>, <span class="attribute">size</span>: &#123; <span class="attribute">h</span>: <span class="number">8.5</span>, <span class="attribute">w</span>: <span class="number">11</span>, <span class="attribute">uom</span>: <span class="string">"in"</span> &#125;, <span class="attribute">status</span>: <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; <span class="attribute">item</span>: <span class="string">"planner"</span>, <span class="attribute">qty</span>: <span class="number">75</span>, <span class="attribute">size</span>: &#123; <span class="attribute">h</span>: <span class="number">22.85</span>, <span class="attribute">w</span>: <span class="number">30</span>, <span class="attribute">uom</span>: <span class="string">"cm"</span> &#125;, <span class="attribute">status</span>: <span class="string">"D"</span> &#125;,</span><br><span class="line">   &#123; <span class="attribute">item</span>: <span class="string">"postcard"</span>, <span class="attribute">qty</span>: <span class="number">45</span>, <span class="attribute">size</span>: &#123; <span class="attribute">h</span>: <span class="number">10</span>, <span class="attribute">w</span>: <span class="number">15.25</span>, <span class="attribute">uom</span>: <span class="string">"cm"</span> &#125;, <span class="attribute">status</span>: <span class="string">"A"</span> &#125;,</span><br><span class="line">] );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除inventory所有数据</span></span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.inventory</span><span class="selector-class">.deleteMany</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除所有匹配的数据</span></span><br><span class="line"><span class="selector-tag">db</span><span class="selector-class">.inventory</span><span class="selector-class">.deleteMany</span>(&#123; <span class="attribute">status </span>: <span class="string">"A"</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除匹配到的第一条数据</span></span><br><span class="line"><span class="comment">//db.inventory.deleteOne( &#123; status: "D" &#125; )</span></span><br></pre></td></tr></table></figure>

<p>删除操作不会删除索引，即使删掉所有文档</p>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">赞赏</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="/img/donate.jpg">
        <p> 感谢鼓励 </p>
    </div>
</div>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/u9646">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://www.skypixel.com" target="_blank" rel="noopener">skypixel</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        <a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener">京ICP备20006007</a>
        </p>
</footer>


</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script type="text/javascript">
       (function() {
           if (typeof LivereTower === 'function') { return; }

           var j, d = document.getElementById('lv-container');

           d.setAttribute('data-id','city');
           d.setAttribute('data-uid' , 'MTAyMC80ODk2MS8yNTQ1NQ==');

           j = document.createElement('script');
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;

           d.appendChild(j);
       })();
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    </div>

</html>
