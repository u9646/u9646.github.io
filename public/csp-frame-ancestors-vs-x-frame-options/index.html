<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="热门技术文章分享">
    <meta name="keyword"  content="fe, js, css, html5, nodejs, webpack, react, vue, nginx">
    <meta name="baidu-site-verification" content="zjvdQ5tUdb" />
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        CSP frame-ancestors 对比 X-Frame-Options - llllll的博客 | HotLinkHub
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158254594-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-158254594-1');
    </script>

<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> H5 React Webpack Mongodb JS CSS Vue </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>llllll</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#X-Frame-Options"><span class="toc-text">X-Frame-Options</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#deny"><span class="toc-text">deny</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sameorigin"><span class="toc-text">sameorigin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#allow-from"><span class="toc-text">allow-from</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如何使用？"><span class="toc-text">如何使用？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSP-frame-ancestors"><span class="toc-text">CSP frame-ancestors</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-host-source-gt"><span class="toc-text">&lt;host-source&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lt-scheme-source-gt"><span class="toc-text">&lt;scheme-source&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#self"><span class="toc-text">self</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#none"><span class="toc-text">none</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#结论"><span class="toc-text">结论</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#测试："><span class="toc-text">测试：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#chrome-v80"><span class="toc-text">chrome v80</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#safari-v12"><span class="toc-text">safari v12</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#firefox-v73"><span class="toc-text">firefox v73</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> H5 React Webpack Mongodb JS CSS Vue </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        CSP frame-ancestors 对比 X-Frame-Options
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2020-03-28 10:01:46</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#安全" title="安全">安全</a>
        <span>/</span>
        
        
        </span>
        <span class="attr"><span id="busuanzi_container_page_pv">
            有<span id="busuanzi_value_page_pv"></span>人看过
          </span></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <blockquote>
<p>这两个字段都是用于控制别的网站使用iframe或者frame加载你的网站的行为</p>
</blockquote>
<h3 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h3><p>该字段有三个可能的值，分别为<code>deny</code>,  <code>sameorigin</code>, <code>allow-from https://example.com/</code>；</p>
<h4 id="deny"><a href="#deny" class="headerlink" title="deny"></a>deny</h4><p><code>deny</code>表示禁止任何使用iframe或者frame加载你的网站。</p>
<h4 id="sameorigin"><a href="#sameorigin" class="headerlink" title="sameorigin"></a>sameorigin</h4><p><code>sameorigin</code>表示只允许同源的网站使用iframe或者frame加载你的网站</p>
<h4 id="allow-from"><a href="#allow-from" class="headerlink" title="allow-from"></a>allow-from</h4><p><code>allow-from</code>表示只允许该网站使用iframe或者frame加载你的网站。</p>
<p>注意：强烈建议不要使用该属性，有两个问题：</p>
<ol>
<li>浏览器兼容性很差，具体可参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options" target="_blank" rel="noopener">MDN X-Frame-Options</a></li>
<li>只能填写一个白名单地址</li>
</ol>
<p>以chrome v80 为例：<br><img src="https://github.com/u9646/u9646.github.io/blob/master/csp-frame-ancestors-vs-x-frame-options/allow-from-test.png?raw=true" alt=""><br>虽然allow-from写成了3100端口，但是页面依然加载出来了。经过测试，safari, firefox（和下面版本相同）都可以正常加载，说明它们都不支持该属性。</p>
<h4 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a>如何使用？</h4><blockquote>
<p><strong><em>设置 meta 标签是无效的！例如 <code>&lt;meta http-equiv=&quot;X-Frame-Options&quot; content=&quot;deny&quot;&gt;</code> 没有任何效果。不要这样用！只有当像下面示例那样设置 HTTP 头 X-Frame-Options 才会生效。</em></strong></p>
</blockquote>
<p>在请求头中增加<code>X-Frame-Options</code>例如：<code>X-Frame-Options: sameorigin</code></p>
<h3 id="CSP-frame-ancestors"><a href="#CSP-frame-ancestors" class="headerlink" title="CSP frame-ancestors"></a>CSP frame-ancestors</h3><p>CSP是指<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener">Content-Security-Policy</a>。</p>
<p><code>frame-ancestors</code>是其中一个指令。指定了一个可以包含<code>&lt;frame&gt;</code>，<code>&lt;iframe&gt;</code>，<code>&lt;object&gt;</code>，<code>&lt;embed&gt;</code>，or <code>&lt;applet&gt;</code>等元素的有效父级。</p>
<blockquote>
<p><strong><em>该指令不支持通过<meta> 元素或通过 <code>Content-Security-policy-Report-Only</code> 头域所指定.</em></strong></p>
</blockquote>
<p>当<code>frame-ancestors</code>设为<code>none</code>时，作用类似于<code>X-Frame-Options: deny</code>。</p>
<p><code>frame-ancestors</code>策略可以设置一个或多个源<code>&lt;source&gt;</code>：</p>
<h4 id="lt-host-source-gt"><a href="#lt-host-source-gt" class="headerlink" title="&lt;host-source&gt;"></a><code>&lt;host-source&gt;</code></h4><p>主机的名称或IP地址，以及一个可选的URL scheme和／或端口号</p>
<p>例如：</p>
<ul>
<li>http://*.example.com: 匹配所有使用http:URL scheme并来对于example.com及其子域名的加载意图。</li>
<li>mail.example.com:443: 匹配所有对于mail.example.com在443端口的访问意图。</li>
<li><a href="https://store.example.com" target="_blank" rel="noopener">https://store.example.com</a>: 匹配所有使用https:访问store.example.com的意图。</li>
</ul>
<h4 id="lt-scheme-source-gt"><a href="#lt-scheme-source-gt" class="headerlink" title="&lt;scheme-source&gt;"></a><code>&lt;scheme-source&gt;</code></h4><p>一个schema配置，比如’http:’或’https:’。注意，冒号是必要的。你同样也可以指定一个data schema（但并不推荐）。</p>
<p>例如：</p>
<ul>
<li>‘data:’ 允许 data: URIs 作为内容源。 这是不安全的，攻击者可以用此来注入恶意代码。请谨慎使用，并不要令其作用于脚本。</li>
<li>‘mediastream:’ 允许 mediastream: URIs 作为内容源.</li>
<li>‘blob:’ 允许 blob: URIs 作为内容源.</li>
<li>‘filesystem:’ 允许 filesystem: URIs 作为内容源.</li>
</ul>
<h4 id="self"><a href="#self" class="headerlink" title="self"></a>self</h4><p>指向一个该受保护文档所在的源，包含同样的URL schema和端口号。必须用单引号设置。有些浏览器会从源指令中排除blob和filesystem。需要允许这些内容类型的站点可以通过Data属性指定它们。</p>
<p>例如：<code>Content-Security-Policy: frame-ancestors &#39;self&#39;</code></p>
<h4 id="none"><a href="#none" class="headerlink" title="none"></a>none</h4><p>指向一个空集，意味着没有URL会被匹配。也需要单引号包裹设置。<br>例如：<code>Content-Security-Policy: frame-ancestors &#39;none&#39;</code></p>
<p>可以同时配置多个规则：<br><code>Content-Security-Policy: frame-ancestors &#39;self&#39; https://example.com</code></p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>当你只需要配置不允许别人使用iframe加载你的网站或者只允许同源网站的时候，使用X-Frame-Options即可。如果你需要使用白名单的方式控制其行为，那么你应该使用<code>Content-Security-Policy: frame-ancestors</code>，它支持配置多个白名单而且具有更好的浏览器兼容性。</p>
<p>当他们同时设置的时候，按规范<code>Content-Security-Policy: frame-ancestors</code>具有更高的优先级。但是现实往往不是如此，很多浏览器对此行为比不一致。建议只设置一个配置。</p>
<h4 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h4><blockquote>
<p>这里以mac上面的几个常用浏览器为例，需要的小伙伴可以使用express自己在本地进行测试。</p>
</blockquote>
<p>比如请求头同时有以下两个配置:<br><code>Content-Security-Policy: frame-ancestors &#39;self&#39; https://example.com</code><br><code>X-Frame-Options: sameorigin</code></p>
<h5 id="chrome-v80"><a href="#chrome-v80" class="headerlink" title="chrome v80"></a>chrome v80</h5><p><img src="https://github.com/u9646/u9646.github.io/blob/master/csp-frame-ancestors-vs-x-frame-options/both-csp-xframe.png?raw=true" alt=""><br>可以看到chrome是可以正常加载的</p>
<h5 id="safari-v12"><a href="#safari-v12" class="headerlink" title="safari v12"></a>safari v12</h5><p><img src="https://github.com/u9646/u9646.github.io/blob/master/csp-frame-ancestors-vs-x-frame-options/both-csp-xframe-safari.png?raw=true" alt=""><br>可以看到safari先判断了x-frame-options，然后就阻止了页面加载。</p>
<h5 id="firefox-v73"><a href="#firefox-v73" class="headerlink" title="firefox v73"></a>firefox v73</h5><p><img src="https://github.com/u9646/u9646.github.io/blob/master/csp-frame-ancestors-vs-x-frame-options/both-csp-xframe-firefox.png?raw=true" alt=""><br>可以看到火狐也是可以正常加载了</p>

        
            <div class="donate-container">
    <div class="donate-button">
        <button id="donate-button">赞赏</button>
    </div>
    <div class="donate-img-container hide" id="donate-img-container">
        <img id="donate-img" src="" data-src="/img/donate.jpg">
        <p> 感谢鼓励 </p>
    </div>
</div>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/u9646">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span>/</span>
        
        <span><a href="https://www.skypixel.com" target="_blank" rel="noopener">skypixel</a></span>
        <span>/</span>
        
    </p>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        <a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener">京ICP备20006007</a>
        </p>
</footer>


</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script type="text/javascript">
       (function() {
           if (typeof LivereTower === 'function') { return; }

           var j, d = document.getElementById('lv-container');

           d.setAttribute('data-id','city');
           d.setAttribute('data-uid' , 'MTAyMC80ODk2MS8yNTQ1NQ==');

           j = document.createElement('script');
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;

           d.appendChild(j);
       })();
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    </div>

</html>
